<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pulse Receiver</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    body {
      background: radial-gradient(circle at top, #1f2933, #020617);
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .app {
      width: 100%;
      max-width: 420px;
      background: rgba(15, 23, 42, 0.96);
      border-radius: 18px;
      padding: 20px 18px 18px;
      box-shadow: 0 18px 45px rgba(0,0,0,0.65);
      border: 1px solid rgba(148,163,184,0.25);
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    .title {
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: .04em;
    }
    .status-pill {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(34,197,94,0.12);
      color: #4ade80;
      border: 1px solid rgba(74,222,128,0.4);
    }
    .card {
      background: rgba(15,23,42,0.9);
      border-radius: 14px;
      padding: 14px 14px 12px;
      border: 1px solid rgba(51,65,85,0.9);
      margin-bottom: 12px;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: .12em;
      color: #9ca3af;
    }
    .pulse-value {
      font-size: 2.4rem;
      font-weight: 600;
      display: flex;
      align-items: baseline;
      gap: 6px;
    }
    .pulse-value span.unit {
      font-size: 0.8rem;
      color: #9ca3af;
      text-transform: uppercase;
    }
    .pulse-bar-wrap {
      margin-top: 8px;
      height: 6px;
      border-radius: 999px;
      background: rgba(31,41,55,1);
      overflow: hidden;
    }
    .pulse-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #22c55e, #eab308, #ef4444);
      transition: width .2s ease-out;
    }
    .session-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 4px;
    }
    .session-row strong {
      color: #e5e7eb;
      font-weight: 500;
    }
    .sessions-list {
      max-height: 180px;
      overflow-y: auto;
      margin-top: 8px;
    }
    .session-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 9px;
      margin-bottom: 6px;
      border-radius: 10px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.9);
      font-size: 0.78rem;
    }
    .session-item .name {
      font-weight: 500;
      color: #e5e7eb;
    }
    .session-item .meta {
      color: #9ca3af;
      display: flex;
      gap: 10px;
    }
    .session-item .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      margin-right: 4px;
    }
    .dot.active { background: #22c55e; box-shadow: 0 0 6px #22c55e; }
    .dot.pending { background: #eab308; }
    .dot.finished { background: #6b7280; }
    .form-row {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    input, button, select {
      border-radius: 999px;
      border: 1px solid rgba(75,85,99,0.9);
      background: rgba(15,23,42,0.9);
      color: #f9fafb;
      font-size: 0.8rem;
      padding: 7px 10px;
    }
    input:focus, select:focus, button:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34,197,94,0.35);
    }
    input[type="number"] { width: 100%; }
    button {
      cursor: pointer;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg,#22c55e,#16a34a);
      padding-inline: 14px;
      font-weight: 500;
      white-space: nowrap;
    }
    button:disabled {
      opacity: 0.4;
      cursor: default;
    }
    .hint {
      margin-top: 6px;
      font-size: 0.7rem;
      color: #6b7280;
    }
  </style>
  <!-- Firebase v10 compat (Realtime Database) [web:1][web:6][web:9][web:18] -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="title">Lush Pulse • Receiver</div>
      <div class="status-pill" id="connectionStatus">LIVE</div>
    </div>

    <div class="card">
      <div class="card-header">
        <span>Live Pulse</span>
        <span id="activeSessionLabel">No active session</span>
      </div>
      <div class="pulse-value">
        <span id="pulseValue">0</span>
        <span class="unit">level</span>
      </div>
      <div class="pulse-bar-wrap">
        <div class="pulse-bar" id="pulseBar"></div>
      </div>
      <div class="session-row">
        <span>Remaining: <strong id="remainingTime">00:00</strong></span>
        <span>State: <strong id="sessionState">idle</strong></span>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <span>Sessions</span>
        <span>Schedule</span>
      </div>
      <div class="form-row">
        <input type="text" id="sessionName" placeholder="Session name (optional)" />
        <input type="number" id="sessionMinutes" min="1" max="180" placeholder="Minutes" />
        <button id="addSessionBtn">Add</button>
      </div>
      <div class="hint">New sessions will appear in the controller list in real time.</div>
      <div class="sessions-list" id="sessionsList"></div>
    </div>
  </div>

  <script>
    // TODO: put your Firebase project config here [web:1][web:12]
    const firebaseConfig = {
    apiKey: "AIzaSyCSQRo8ee2Dj26J0PQyQsosLfkNDw4Lni0",
    authDomain: "testapp-9b43c.firebaseapp.com",
    databaseURL: "https://testapp-9b43c-default-rtdb.firebaseio.com",
    projectId: "testapp-9b43c",
    storageBucket: "testapp-9b43c.firebasestorage.app",
    messagingSenderId: "475089690708",
    appId: "1:475089690708:web:f86d7436dfa74a96134dc1",
    measurementId: "G-FZCZQGZD5Y"
  };
      

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const pulseRef = db.ref("device/pulseLevel");
    const sessionRef = db.ref("device/session");
    const sessionsRef = db.ref("device/sessions");

    const pulseValueEl = document.getElementById("pulseValue");
    const pulseBarEl = document.getElementById("pulseBar");
    const remainingTimeEl = document.getElementById("remainingTime");
    const sessionStateEl = document.getElementById("sessionState");
    const activeSessionLabelEl = document.getElementById("activeSessionLabel");
    const connectionStatusEl = document.getElementById("connectionStatus");

    const sessionNameInput = document.getElementById("sessionName");
    const sessionMinutesInput = document.getElementById("sessionMinutes");
    const addSessionBtn = document.getElementById("addSessionBtn");
    const sessionsListEl = document.getElementById("sessionsList");

    let lastPulseTs = Date.now();

    pulseRef.on("value", (snap) => {
      const level = snap.val() ?? 0;
      lastPulseTs = Date.now();
      const clamped = Math.max(0, Math.min(10, Number(level)));
      pulseValueEl.textContent = clamped.toFixed(0);
      pulseBarEl.style.width = (clamped * 10) + "%";
    });

    sessionRef.on("value", (snap) => {
      const data = snap.val();
      if (!data) {
        sessionStateEl.textContent = "idle";
        remainingTimeEl.textContent = "00:00";
        activeSessionLabelEl.textContent = "No active session";
        return;
      }
      sessionStateEl.textContent = data.state ?? "idle";
      activeSessionLabelEl.textContent = data.name ? ("Active • " + data.name) : "Active session";
      if (typeof data.remainingSeconds === "number") {
        const r = Math.max(0, data.remainingSeconds);
        const m = String(Math.floor(r / 60)).padStart(2, "0");
        const s = String(r % 60).padStart(2, "0");
        remainingTimeEl.textContent = m + ":" + s;
      }
    });

    sessionsRef.on("value", (snap) => {
      sessionsListEl.innerHTML = "";
      const val = snap.val() || {};
      Object.keys(val).forEach((key) => {
        const s = val[key];
        const item = document.createElement("div");
        item.className = "session-item";
        const statusDotClass =
          s.state === "active" ? "dot active" :
          s.state === "finished" ? "dot finished" : "dot pending";

        item.innerHTML = `
          <div>
            <span class="name">${s.name || "Session"}</span>
            <div style="display:flex;align-items:center;margin-top:2px;font-size:0.72rem;color:#9ca3af;">
              <div class="${statusDotClass} dot"></div>
              <span>${s.state || "pending"}</span>
            </div>
          </div>
          <div class="meta">
            <span>${s.minutes || 0} min</span>
          </div>
        `;
        sessionsListEl.appendChild(item);
      });
    });

    addSessionBtn.addEventListener("click", () => {
      const name = sessionNameInput.value.trim() || "Session";
      const minutes = parseInt(sessionMinutesInput.value, 10);
      if (!minutes || minutes <= 0) return;
      const newRef = sessionsRef.push();
      newRef.set({
        id: newRef.key,
        name,
        minutes,
        state: "pending",
        createdAt: Date.now()
      });
      sessionMinutesInput.value = "";
      sessionNameInput.value = "";
    });

    setInterval(() => {
      const delta = Date.now() - lastPulseTs;
      if (delta > 6000) {
        connectionStatusEl.textContent = "OFFLINE";
        connectionStatusEl.style.background = "rgba(239,68,68,0.12)";
        connectionStatusEl.style.color = "#f87171";
        connectionStatusEl.style.borderColor = "rgba(248,113,113,0.5)";
      } else {
        connectionStatusEl.textContent = "LIVE";
        connectionStatusEl.style.background = "rgba(34,197,94,0.12)";
        connectionStatusEl.style.color = "#4ade80";
        connectionStatusEl.style.borderColor = "rgba(74,222,128,0.4)";
      }
    }, 3000);
  </script>
</body>
</html>
